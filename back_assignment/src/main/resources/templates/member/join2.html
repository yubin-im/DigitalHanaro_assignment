<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원가입2</title>

  <!-- Main CSS : Header, Main, Footer -->
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/member/join.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

  <!-- Bootstarp JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

  <script>
    $(document).ready(function(){
      $('#headerTop').load("../headerTop-sub.html");
      $('#header').load("../header-sub.html");
      $('#footer').load("../footer-sub.html");
    });
  </script>

</head>
<body>
<!-- 헤더 -->
<div th:replace="/fragments/headerTop.html :: fragment-headerTop"></div>
<div th:replace="/fragments/header.html :: fragment-header" class="sticky-top"></div>

<!-- 메인 -->
<!-- COMMON -->
<div class="commonSection1">
  <div class="commonContent1">
    <img src="../img/member/sub-visual02.jpg"
         style="width: 100%; height: 100%;">
    <div class="commonContent2 text-center">
      <div>
        <h3>MEMBER</h3>
      </div>
      <div>
        <p><img src="../img/icon-home.png"> > 회원가입</p>
      </div>
    </div>
  </div>
</div>

<!-- 메인 -->
<!-- 회원가입 -->
<div class="joinForm container">

  <div class="joinSection1">
    <div><h3>회원가입</h3></div>
    <div><p>The design and maintenance are excellent.</p></div>
  </div>
  <div class="wellcome">
    <h3>OOO사이트에 오신 것을 환영합니다.</h3>
    <h5>-이름과 이메일을 입력해 주시면 가입여부를 확인 후 회원가입 절차가 이루어집니다.</h5>
  </div>
  <br><br>
  <div class="contents">
    <h3>회원가입을 위해서 아래의 양식에 있는 내용을 입력해 주셔야 합니다.</h3>
    <h5>-회원님의 개인정보를 신중하게 보호하고 있으며 회원님의 동의 없이는 기재하신 회원정보가 누출되지 않습니다.
      자세한 내용은 개인정보보호정책에서 확인하세요.</h5>
  </div>
  <!-- 입력폼 -->
  <form name="joinForm" id="joinForm">
    <div class="information1">
      <div>기본정보</div>

      <table>
        <tr>
          <td>아이디</td>
          <td>
            <input type="text" name="userID" id="userID">
            <img src="../img/member/btn_iddupl.gif" onclick="checkDuplicateId()">
            (영문 소문자, 숫자로 4~16자)
          </td>
        </tr>
        <tr>
          <td>비밀번호</td>
          <td>
            <input type="password" name="userPW" id="userPW">
            영문/숫자/특수문자조합으로 8~16자리. 첫글자는 영문자로 사용
          </td>
        </tr>
        <tr>
          <td>비밀번호 확인</td>
          <td><input type="password" name="userPWCheck" id="userPWCheck"></td>
        </tr>
        <tr>
          <td>이름</td>
          <td><input type="text" id="userName"></td>
        </tr>
        <tr>
          <td>이메일</td>
          <td><input type="text" id="userEmail"></td>
        </tr>
        <tr>
          <td>이메일 수신여부</td>
          <td><input type="radio" name="receive" value="1">수신
            <input type="radio" name="receive" value="0">수신안함</td>
        </tr>
        <tr>
          <td>비밀번호 확인시 질문</td>
          <td>
            <select class="size" name="passwordCheckQuestion" id="PwCheckQ">
              <option value="0">========선택========</option>
              <option value="1">기억에 남는 추억의 장소는?</option>
              <option value="2">자신의 인생 좌우명은?</option>
              <option value="3">자신의 보물 제1호는?</option>
              <option value="4">가장 기억에 남는 선생님 성함은?</option>
              <option value="5">내가 좋아하는 캐릭터는?</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>비밀번호 확인시 답변</td>
          <td><input type="text" name="passwordCheckAnswer" id="PwCheckAns"></td>
        </tr>
        <tr>
          <td>성별</td>
          <td><input type="radio" name="gender" value="male">남자<input type="radio" name="gender" value="female">여자</td>
        </tr>
        <tr>
          <td>생년월일</td>
          <td>
            <input type="date" id="birthDate">
          </td>
        </tr>
      </table>

    </div>
    <div class="Information2">부가정보</div>
    <div class="imageBtn2">
      <button type="button" onclick="join()">
        <img src="../img/member/btn_confirm.gif" alt="확인">
      </button>
    </div>
  </form>
  <div class="imageBtn2">
    <input type="image" src="../img/member/btn_cancel.gif" onclick="history.back();">
  </div>
</div>



<!-- 푸터 -->
<div th:replace="/fragments/footer.html :: fragment-footer"></div>

<script>
  // 회원가입 기능
  const join = () => {
    // 입력정보(아이디, 비밀번호, 비밀번호 확인) 필수 기능
    if (!checkInput()) {
      return;
    }

    // 비밀번호 4자리 이상 확인 기능
    if (!checkPwLength()) {
      return;
    }

    // 비밀번호, 비밀번호 확인 값 일치 확인 기능
    if (!checkPwMatch()) {
      return;
    }

    // 사용자 선택값 가져오기 (동의, 성별)
    const selectedEmailReceive = document.querySelector('input[name="receive"]:checked').value;
    const selectedGender = document.querySelector('input[name="gender"]:checked').value;

    const memberId = document.getElementById("userID").value;
    const memberPw = document.getElementById("userPW").value;
    const memberName = document.getElementById("userName").value;
    const memberEmail = document.getElementById("userEmail").value;
    const memberEmailReceive = selectedEmailReceive;
    const memberPwQuestion = document.getElementById("PwCheckQ").value;
    const memberPwAnswer = document.getElementById("PwCheckAns").value;
    const memberGender = selectedGender;
    const memberBirthDate = document.getElementById("birthDate").value;

    fetch("/member/join-action", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        memberId: memberId,
        memberPw: memberPw,
        memberName: memberName,
        memberEmail: memberEmail,
        memberEmailReceive: memberEmailReceive,
        memberPwQuestion: memberPwQuestion,
        memberPwAnswer: memberPwAnswer,
        memberGender: memberGender,
        memberBirthDate: memberBirthDate
      })
    })
    .then(response => {
      if (response.ok) {
        alert("회원가입이 완료되었습니다!")
        window.location.href = "/";
      } else {
        console.error("회원가입 실패");
      }
    })
    .catch(error => {
      console.error("오류 발생: ", error);
    })
  }

  // 입력정보(아이디, 비밀번호, 비밀번호 확인) 필수 기능
  const checkInput = () => {
    const memberId = document.getElementById("userID").value;
    const memberPw = document.getElementById("userPW").value;
    const memberPwCheck = document.getElementById("userPWCheck").value;

    if (!memberId || !memberPw || !memberPwCheck) {
      alert("아이디, 비밀번호, 비밀번호 확인은 필수 입력 항목입니다.");
      return false;
    }
    return true;
  }

  // 비밀번호 4자리 이상 확인 기능
  const checkPwLength = () => {
    const password = document.getElementById("userPW").value;
    if (password.length < 4) {
      alert("비밀번호는 4자리 이상이어야 합니다.");
      return false;
    }
    return true;
  }

  // 비밀번호, 비밀번호 확인 값 일치 확인 기능
  const checkPwMatch = () => {
    const password = document.getElementById("userPW").value;
    const passwordCheck = document.getElementById("userPWCheck").value;

    if (password !== passwordCheck) {
      alert("비밀번호와 비밀번호 확인 값이 일치하지 않습니다.");
      return false;
    }
    return true;
  }

  // 아이디 중복 확인 기능
  const checkDuplicateId = () => {
    const memberId = document.getElementById("userID").value;

    fetch("/check-duplicate-id", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ memberId: memberId })
    })
            .then(response => response.json())
            .then(data => {
              if (data.duplicate) {
                alert("중복된 아이디입니다.");
              } else {
                alert("사용가능한 아이디 입니다.");
              }
            })
            .catch(error => {
              console.error("오류 발생: ", error);
            });
  }
</script>
</body>
</html>